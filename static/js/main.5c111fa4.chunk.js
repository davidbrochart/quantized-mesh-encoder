(this.webpackJsonpsite=this.webpackJsonpsite||[]).push([[0],{203:function(e,t){},204:function(e,t){},297:function(e,t,a){e.exports=a(424)},302:function(e,t,a){},303:function(e,t){},423:function(e,t,a){},424:function(e,t,a){"use strict";a.r(t);var n=a(3),r=a.n(n),i=a(110),o=a.n(i),s=(a(302),a(20)),l=a(2),u=a(1),c=a(156),h=a(13),d=a(450),f=a(66),m=a.n(f),v=a(103),y=a(456),p=a(18),g=a(451),b=a(454),x=a(158),_=a(105),z=a(447),T=a(452),S=a(14),w=a(62),k=a(17),L=function(){function e(t){var a=t.x,n=t.y,r=t.z,i=t.onTileLoad,o=t.onTileError;Object(l.a)(this,e),this.x=a,this.y=n,this.z=r,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this._isCancelled=!1,this.onTileLoad=i,this.onTileError=o}return Object(u.a)(e,[{key:"_loadData",value:function(){var e=Object(v.a)(m.a.mark((function e(t,a){var n,r,i,o,s,l,u;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.x,r=this.y,i=this.z,o=this.bbox,e.next=3,a.scheduleRequest(this,(function(e){return e.isSelected}));case 3:if(s=e.sent){e.next=7;break}return this._isCancelled=!0,e.abrupt("return");case 7:return this._isCancelled=!1,e.prev=8,e.next=11,t({x:n,y:r,z:i,bbox:o});case 11:l=e.sent,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),u=e.t0||!0;case 17:return e.prev=17,s.done(),this._isLoaded=!0,e.finish(17);case 21:u?this.onTileError(u,this):(this.content=l,this.onTileLoad(this));case 22:case"end":return e.stop()}}),e,this,[[8,14,17,21]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loadData",value:function(e,t){e&&(this._loader=this._loadData(e,t))}},{key:"data",get:function(){return this._isLoaded?this.content:this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"isCancelled",get:function(){return this._isCancelled}},{key:"byteLength",get:function(){var e=this.content?this.content.byteLength:0;return Number.isFinite(e)||k.a.error("byteLength not defined in tile data")(),e}}]),e}(),O=a(174),j=function(){function e(t,a,n){Object(l.a)(this,e),this.x=t,this.y=a,this.z=n}return Object(u.a)(e,[{key:"update",value:function(e){var t=e.viewport,a=e.cullingVolume,n=e.elevationBounds,r=e.minZ,i=e.maxZ,o=e.offset,s=this.getBoundingVolume(n,o);if(a.computeVisibility(s)<0)return!1;if(!this.childVisible){var l=this.z;if(l<i&&l>=r){var u=s.distanceTo(t.cameraPosition)*t.scale/t.height;l+=Math.floor(Math.log2(u))}if(l>=i)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;var c,h=Object(w.a)(this.children);try{for(h.s();!(c=h.n()).done;){c.value.update(e)}}catch(d){h.e(d)}finally{h.f()}return!0}},{key:"getSelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.selected&&e.push(this),this._children){var t,a=Object(w.a)(this._children);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.getSelected(e)}}catch(r){a.e(r)}finally{a.f()}}return e}},{key:"getBoundingVolume",value:function(e,t){var a=512/Math.pow(2,this.z),n=this.x*a+512*t,r=512-(this.y+1)*a;return new O.a([n,r,e[0]],[n+a,r+a,e[1]])}},{key:"children",get:function(){if(!this._children){var t=2*this.x,a=2*this.y,n=this.z+1;this._children=[new e(t,a,n),new e(t,a+1,n),new e(t+1,a,n),new e(t+1,a+1,n)]}return this._children}}]),e}();var M=[-1/0,-1/0,1/0,1/0],E={type:"url",value:"",validate:function(e){return"string"===typeof e||Array.isArray(e)&&e.every((function(e){return"string"===typeof e}))},equals:function(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;var a=e.length;if(a!==t.length)return!1;for(var n=0;n<a;n++)if(e[n]!==t[n])return!1;return!0}};function C(e,t){var a=Object(S.a)(e,2);return[a[0]*t/512,a[1]*t/512]}function Z(e){return Math.pow(2,e)}function R(e,t,a){var n=Z(a),r=e/n*360-180,i=Math.PI-2*Math.PI*t/n;return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}function V(e,t,a){var n=Z(a);return[e/n*512,t/n*512]}function B(e,t,a,n){if(e.isGeospatial){var r=R(t,a,n),i=Object(S.a)(r,2),o=i[0],s=i[1],l=R(t+1,a+1,n),u=Object(S.a)(l,2);return{west:o,north:s,east:u[0],south:u[1]}}var c=V(t,a,n),h=Object(S.a)(c,2),d=h[0],f=h[1],m=V(t+1,a+1,n),v=Object(S.a)(m,2);return{left:d,top:f,right:v[0],bottom:v[1]}}function q(e,t,a){for(var n=function(e,t,a){var n;if(t&&2===t.length){var r=Object(S.a)(t,2),i=r[0],o=r[1],s=e.getBounds({z:i}),l=e.getBounds({z:o});n=[Math.min(s[0],l[0]),Math.min(s[1],l[1]),Math.max(s[2],l[2]),Math.max(s[3],l[3])]}else n=e.getBounds();return[Math.max(n[0],a[0]),Math.max(n[1],a[1]),Math.min(n[2],a[2]),Math.min(n[3],a[3])]}(e,null,a),r=Z(t),i=C([n[0],n[1]],r),o=Object(S.a)(i,2),s=o[0],l=o[1],u=C([n[2],n[3]],r),c=Object(S.a)(u,2),h=c[0],d=c[1],f=[],m=Math.floor(s);m<h;m++)for(var v=Math.floor(l);v<d;v++)f.push({x:m,y:v,z:t});return f}function I(e){var t=e.viewport,a=e.maxZoom,n=e.minZoom,r=e.zRange,i=e.extent,o=e.tileSize,s=void 0===o?512:o,l=Math.round(t.zoom+Math.log2(512/s));if(Number.isFinite(n)&&l<n){if(!i)return[];l=n}return Number.isFinite(a)&&l>a&&(l=a),t.isGeospatial?function(e,t,a){var n=Object.values(e.getFrustumPlanes()).map((function(e){var t=e.normal,a=e.distance;return new O.c(t.clone().negate(),a)})),r=new O.b(n),i=e.distanceScales.unitsPerMeter[2],o=a&&a[0]*i||0,s=a&&a[1]*i||0,l=e.pitch<=60?t:0,u=new j(0,0,0),c={viewport:e,cullingVolume:r,elevationBounds:[o,s],minZ:l,maxZ:t,offset:0};if(u.update(c),e.subViewports&&e.subViewports.length>1){for(c.offset=-1;u.update(c)&&!(--c.offset<-3););for(c.offset=1;u.update(c)&&!(++c.offset>3););}return u.getSelected()}(t,l,r):q(t,l,i||M)}var D=a(457),N=function(){function e(t){var a=this;Object(l.a)(this,e),this.opts=t,this._getTileData=t.getTileData,this.onTileError=t.onTileError,this.onTileLoad=function(e){t.onTileLoad(e),a.opts.maxCacheByteSize&&(a._cacheByteSize+=e.byteLength,a._resizeCache())},this._requestScheduler=new D.a({maxRequests:t.maxRequests,throttleRequests:t.throttleRequests&&t.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(t)}return Object(u.a)(e,[{key:"setOptions",value:function(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}},{key:"update",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.zRange;if(!e.equals(this._viewport)){this._viewport=e;var r=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n});this._selectedTiles=r.map((function(e){return t._getTile(e,!0)})),this._dirty&&this._rebuildTree()}var i=this.updateTileStates();return this._dirty&&this._resizeCache(),i&&this._frameNumber++,this._frameNumber}},{key:"getTileIndices",value:function(e){var t=e.viewport,a=e.maxZoom,n=e.minZoom,r=e.zRange,i=this.opts;return I({viewport:t,maxZoom:a,minZoom:n,zRange:r,tileSize:i.tileSize,extent:i.extent})}},{key:"getTileMetadata",value:function(e){var t=e.x,a=e.y,n=e.z;return{bbox:B(this._viewport,t,a,n)}}},{key:"getParentIndex",value:function(e){return e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),e.z-=1,e}},{key:"updateTileStates",value:function(){this._updateTileStates(this.selectedTiles);var e,t=!1,a=Object(w.a)(this._cache.values());try{for(a.s();!(e=a.n()).done;){var n=e.value,r=Boolean(1&n.state);n.isVisible!==r&&(t=!0,n.isVisible=r),n.isSelected=5===n.state}}catch(i){a.e(i)}finally{a.f()}return t}},{key:"_rebuildTree",value:function(){var e,t=this._cache,a=Object(w.a)(t.values());try{for(a.s();!(e=a.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(l){a.e(l)}finally{a.f()}var r,i=Object(w.a)(t.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,s=this._getNearestAncestor(o.x,o.y,o.z);o.parent=s,s&&s.children.push(o)}}catch(l){i.e(l)}finally{i.f()}}},{key:"_updateTileStates",value:function(e){var t,a=this._cache,n=this.opts.refinementStrategy||"best-available",r=Object(w.a)(a.values());try{for(r.s();!(t=r.n()).done;){t.value.state=0}}catch(d){r.e(d)}finally{r.f()}var i,o=Object(w.a)(e);try{for(o.s();!(i=o.n()).done;){i.value.state=5}}catch(d){o.e(d)}finally{o.f()}if("never"!==n){var s,l=Object(w.a)(e);try{for(l.s();!(s=l.n()).done;){A(s.value,n)}}catch(d){l.e(d)}finally{l.f()}var u,c=Object(w.a)(e);try{for(c.s();!(u=c.n()).done;){var h=u.value;P(h)&&F(h)}}catch(d){c.e(d)}finally{c.f()}}}},{key:"_resizeCache",value:function(){var e=this._cache,t=this.opts,a=t.maxCacheSize||(t.maxCacheByteSize?1/0:5*this.selectedTiles.length),n=t.maxCacheByteSize||1/0;if(e.size>a||this._cacheByteSize>n){var r,i=Object(w.a)(e);try{for(i.s();!(r=i.n()).done;){var o=Object(S.a)(r.value,2),s=o[0],l=o[1];if(l.isVisible||(this._cacheByteSize-=t.maxCacheByteSize?l.byteLength:0,e.delete(s)),e.size<=a&&this._cacheByteSize<=n)break}}catch(u){i.e(u)}finally{i.f()}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((function(e,t){return e.z-t.z})),this._dirty=!1)}},{key:"_getTile",value:function(e,t){var a=e.x,n=e.y,r=e.z,i="".concat(a,",").concat(n,",").concat(r),o=this._cache.get(i);return!o&&t?(o=new L({x:a,y:n,z:r,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData,this._requestScheduler),this._cache.set(i,o),this._dirty=!0):o&&o.isCancelled&&o.loadData(this._getTileData,this._requestScheduler),o}},{key:"_getNearestAncestor",value:function(e,t,a){for(var n=this._minZoom,r=void 0===n?0:n,i={x:e,y:t,z:a};i.z>r;){i=this.getParentIndex(i);var o=this._getTile(i);if(o)return o}return null}},{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles.every((function(e){return e.isLoaded}))}}]),e}();function P(e){for(var t=e;t;){if(!1&t.state)return!0;if(t.isLoaded)return!1;t=t.parent}return!0}function A(e,t){for(var a,n=3;a=e.parent;){if(e.isLoaded&&(n=4,"best-available"===t))return;a.state=Math.max(a.state,n),e=a}}function F(e){var t,a=Object(w.a)(e.children);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.state=Math.max(n.state,3),n.isLoaded||F(n)}}catch(r){a.e(r)}finally{a.f()}}var U={data:[],dataComparator:E.equals,renderSubLayers:{type:"function",value:function(e){return new T.a(e)},compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:function(e){},compare:!1},onTileError:{type:"function",value:function(e){return console.error(e)},compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,throttleRequests:!0,maxRequests:8},H=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){var t=e.props,a=(e.oldProps,e.context,e.changeFlags),n=this.state.tileset;if(!n||a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getTileData)){var r=t.maxZoom,i=t.minZoom,o=t.tileSize,s=t.maxCacheSize,l=t.maxCacheByteSize,u=t.refinementStrategy,c=t.extent,h=t.throttleRequests,d=t.maxRequests;n=new N({getTileData:this.getTileData.bind(this),maxCacheSize:s,maxCacheByteSize:l,maxZoom:r,minZoom:i,tileSize:o,refinementStrategy:u,extent:c,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),throttleRequests:h,maxRequests:d}),this.setState({tileset:n})}else(a.propsChanged||a.updateTriggersChanged)&&(n.setOptions(t),this.state.tileset.tiles.forEach((function(e){e.layers=null})));this._updateTileset()}},{key:"_updateTileset",value:function(){var e=this.state.tileset,t=this.props,a=t.onViewportLoad,n=t.zRange,r=e.update(this.context.viewport,{zRange:n}),i=e.isLoaded,o=this.state.isLoaded!==i,s=this.state.frameNumber!==r;i&&a&&(o||s)&&a(e.selectedTiles.map((function(e){return e.data}))),s&&this.setState({frameNumber:r}),this.state.isLoaded=i}},{key:"_onTileLoad",value:function(e){this.getCurrentLayer().props.onTileLoad(e),e.isVisible&&this.setNeedsUpdate()}},{key:"_onTileError",value:function(e,t){var a=this.getCurrentLayer();a.props.onTileError(e),a._updateTileset(),t.isVisible&&this.setNeedsUpdate()}},{key:"getTileData",value:function(e){var t,a,n=this.props,r=n.getTileData,i=n.fetch,o=n.data;return e.url=(a=e,(t=o)&&t.length?(Array.isArray(t)&&(t=t[Math.abs(a.x+a.y)%t.length]),t.replace?t.replace(/\{ *([\w_-]+) *\}/g,(function(e,t){return a[t]})):null):null),r?r(e):e.url?i(e.url,{layer:this}):null}},{key:"renderSubLayers",value:function(e){return this.props.renderSubLayers(e)}},{key:"getHighlightedObjectIndex",value:function(){return-1}},{key:"getPickingInfo",value:function(e){var t=e.info,a=e.sourceLayer;return t.sourceLayer=a,t.tile=a.props.tile,t}},{key:"renderLayers",value:function(){var e=this,t=this.props.visible;return this.state.tileset.tiles.map((function(a){var n=t&&a.isVisible,r=e.getHighlightedObjectIndex(a);if(a.isLoaded)if(a.layers)!a.layers[0]||a.layers[0].props.visible===n&&a.layers[0].props.highlightedObjectIndex===r||(a.layers=a.layers.map((function(e){return e.clone({visible:n,highlightedObjectIndex:r})})));else{var i=e.renderSubLayers(Object.assign({},e.props,{id:"".concat(e.id,"-").concat(a.x,"-").concat(a.y,"-").concat(a.z),data:a.data,visible:n,_offset:0,tile:a,highlightedObjectIndex:r}));a.layers=Object(_.b)(i,Boolean)}else;return a.layers}))}},{key:"isLoaded",get:function(){return this.state.tileset.selectedTiles.every((function(e){return e.layers&&e.layers.every((function(e){return e.isLoaded}))}))}}]),a}(z.a);H.layerName="TileLayer",H.defaultProps=U;var W=[1];function G(e){return(77067.34/(1<<e)).toFixed(2)}function J(e){var t=e.x,a=e.y,n=e.z,r=e.mosaicUrl,i=void 0===r?"terrarium":r,o=e.meshMaxError,s=new URLSearchParams({url:i,mesh_max_error:void 0===o?10:o});return"https://us-east-1-lambda.kylebarron.dev/dem/mesh/".concat(n,"/").concat(t,"/").concat(a,".terrain?")+s.toString()}function Y(e){var t=e||{},a=t.minZoom,n=void 0===a?0:a,r=t.maxZoom,i=void 0===r?15:r,o=t.onViewportLoad,s=t.zRange;return new H({id:"quantized-mesh-tile",minZoom:n,maxZoom:i,getTileData:Q,renderSubLayers:K,onViewportLoad:o,zRange:s,refinementStrategy:"no-overlap"})}function Q(e){return $.apply(this,arguments)}function $(){return($=Object(v.a)(m.a.mark((function e(t){var a,n,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.x,n=t.y,r=t.z,i=G(r),o=J({x:a,y:n,z:r,meshMaxError:i}),e.abrupt("return",Object(g.a)(o,b.a));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){var t=e.data,a=e.tile;return[new y.a(e,{id:"terrain-simple-mesh-layer-".concat(a.x,"-").concat(a.y,"-").concat(a.z),data:W,mesh:t,getPolygonOffset:null,coordinateSystem:p.a.CARTESIAN,modelMatrix:X(a),getPosition:function(e){return[0,0,0]},getColor:[200,200,200]})]}function X(e){var t=Math.pow(2,e.z),a=512/t,n=-a,r=512*e.x/t,i=512*(1-e.y/t);return(new x.a).translate([r,i,0]).scale([a,n,1])}var ee=a(449),te=a(453),ae=a(209);function ne(e){return r.a.createElement(ee.a,{style:{position:"absolute",width:300,maxWidth:"50%",left:5,top:5,padding:5,maxHeight:"50%",zIndex:1,backgroundColor:"#fff",pointerEvents:"auto",overflowY:"auto",overflow:"visible"}},r.a.createElement(te.a,{as:"h4"},"Serverless Quantized Mesh"),r.a.createElement("p",null,"Uses"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/kylebarron/pymartini"},r.a.createElement(ae.a,{name:"github"}),r.a.createElement("code",null,"pymartini"))," ","for mesh generation,"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/kylebarron/quantized-mesh-encoder"},r.a.createElement(ae.a,{name:"github"}),r.a.createElement("code",null,"quantized-mesh-encoder"))," ","for encoding to quantized mesh,"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/kylebarron/dem-tiler"},r.a.createElement(ae.a,{name:"github"}),r.a.createElement("code",null,"dem-tiler"))," ","for the serverless API, and"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://deck.gl"},r.a.createElement("code",null,"deck.gl"))," ","for rendering. You can also easily overlay a texture source, e.g. Mapbox Satellite tiles, with deck.gl."," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/kylebarron/quantized-mesh-encoder/tree/master/site"},r.a.createElement(ae.a,{name:"github"}),"Example source.")))}a(423);var re={latitude:36.07091852096502,longitude:-112.00934837595949,bearing:-35.19642857142857,pitch:60,zoom:13.574472859832357,maxPitch:89},ie=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={viewState:re,zRange:null},e.onViewportLoad=function(t){if(t&&0!==t.length&&!t.every((function(e){return!e}))){var a=e.state.zRange,n=t.map((function(e){return e.header.boundingBox.map((function(e){return e[2]}))})),r=Math.min.apply(Math,Object(s.a)(n.map((function(e){return e[0]})))),i=Math.max.apply(Math,Object(s.a)(n.map((function(e){return e[1]}))));(!a||r<a[0]||i>a[1])&&e.setState({zRange:[r,i]})}},e}return Object(u.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.viewState,n=t.zRange,i=[Y({onViewportLoad:this.onViewportLoad,zRange:n})];return r.a.createElement("div",null,r.a.createElement(d.a,{initialViewState:a,layers:i,onViewStateChange:function(t){return e.setState({viewState:t})},controller:{touchRotate:!0}}),r.a.createElement(ne,null))}}]),a}(r.a.Component);document.body.style.margin=0;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[297,1,2]]]);
//# sourceMappingURL=main.5c111fa4.chunk.js.map